window.addEventListener("DOMContentLoaded",()=>{let t=!1,o=!1,r;var e=config.root+config.path;const s=document.getElementById("search-input");function v(e,t,n){var o=e.length;if(0===o)return[];let r=0;var s;let l=[];for(n||(t=t.toLowerCase(),e=e.toLowerCase());-1<(s=t.indexOf(e,r));)l.push({position:s,word:e}),r=s+o;return l}function g(e,t,n,o){var r=n[n.length-1];let s=r.position,l=r.word,c=[],u=0;for(;s+l.length<=t&&0!==n.length;){l===o&&u++,c.push({position:s,length:l.length});var i=s+l.length;for(n.pop();0!==n.length&&(r=n[n.length-1],s=r.position,l=r.word,i>s);)n.pop()}return{hits:c,start:e,end:t,TextCount:u}}function y(n,e){let o="",r=e.start;return e.hits.forEach(e=>{o+=n.substring(r,e.position);var t=e.position+e.length;o+=`<nobr class="search-keyword">${n.substring(e.position,t)}</nobr>`,r=t}),o+=n.substring(r,e.end)}function l(){document.querySelector(".search-popup").innerHTML='<div id="loading"><p>Loading...</p></div>'}function c(){document.querySelector(".up")&&document.querySelector(".closed")&&document.querySelector(".navBtn").classList.remove("expanded"),1023<window.innerWidth&&document.body.classList.remove("blur"),document.querySelector(".search-popup").classList.remove("open")}function n(){if(1023<window.innerWidth&&document.body.classList.add("blur"),document.querySelector(".up")&&document.querySelector(".closed")&&document.querySelector(".navBtn").classList.add("expanded"),document.querySelector(".search-popup").classList.add("open"),!0===t?(document.querySelector(".search-popup").innerHTML="<div id='search-result'></div>",document.getElementById("search-result").innerHTML=""):l(),!1===t)o=!0,l();else{let m=s.value.trim().toLowerCase();if(m.length){let e=m.split(/[-\s]+/),p=(1<e.length&&e.push(m),[]);0<m.length&&r.forEach(d=>{if(d.title){let o=0,r=0,s=0,l=d.title.trim(),n=l.toLowerCase(),c=d.content?d.content.trim().replace(/<[^>]+>/g,""):"",u=c.toLowerCase();d=decodeURIComponent(d.url).replace(/\/{2,}/g,"/");let i=[],a=[];if(e.forEach(e=>{var t=v(e,n,!1),e=v(e,u,!1);i=i.concat(t),a=a.concat(e),(0<t.length||0<e.length)&&o++,0<t.length&&r++,(0<t.length||0<e.length)&&s++}),0<i.length||0<a.length){[i,a].forEach(e=>{e.sort((e,t)=>t.position!==e.position?t.position-e.position:e.word.length-t.word.length)});let e=[],t=[];0!==i.length&&(h=g(0,l.length,i,m),e.push(h));var h=parseInt(config.top_n_per_article,10);0<=h&&(t=t.slice(0,h));let n="";if(0!==e.length?n+=`<a href="${d}" class="recent-post"><b class="search-result-title">${y(l,e[0])}</b>`:n+=`<a href="${d}" class="recent-post"><b class="search-result-title">${l}</b>`,null!==a&&0!==a.length){h=a[a.length-1],d=h.position,h=h.word;let e=d-20,t=d+80;e<0&&(e=0),(t=t<d+h.length?d+h.length:t)>c.length&&(t=c.length);d=g(e,t,a,m);n+=`<p class="search-result">${y(c,d)}...</p>`}else n+=`<p class="search-result">${c}...</p>`;n+="</a>",p.push({item:n,TextCount:o,TitleCount:r,ContentCount:s,id:p.length})}}});var n=document.getElementById("search-result");if(0===p.length)n.innerHTML=`<div id="no-result"><p>无“<b>${s.value}</b>”相关数据</p></div>`;else{p.sort((e,t)=>e.TextCount!==t.TextCount?t.TextCount-e.TextCount:e.TitleCount!==t.TitleCount?t.TitleCount-e.TitleCount:e.ContentCount!==t.ContentCount?t.ContentCount-e.ContentCount:t.id-e.id);let t="";p.forEach(e=>{t+=e.item}),n.innerHTML=t}"undefined"!=typeof pjax&&pjax.refresh(n)}else document.querySelector("#search-input").placeholder="键入以进行",c()}}function u(){document.querySelector("#search-input").value="",document.querySelector(".navContent").classList.remove("search"),document.removeEventListener("mouseup",u),o=!1,document.querySelector(".navContent").classList.remove("search"),document.querySelector(".navContent").classList.add("moved"),c()}fetch(e).then(e=>e.text()).then(e=>{t=!0,r=JSON.parse(e),!0===o&&n()}),s.addEventListener("keypress",e=>{13===e.key&&n()}),document.querySelector("#search-input").addEventListener("keyup",()=>{document.querySelector(".navContent").classList.add("search"),document.querySelector(".navContent").classList.remove("moved"),n()}),document.querySelector("#search-input").addEventListener("focus",()=>{document.querySelector(".navContent").classList.add("search"),header.closeAll(),!(document.querySelector("#search-input").placeholder="键入以进行")===t&&l()}),document.querySelector("#search-input").addEventListener("blur",()=>{document.querySelector("#search-input").placeholder="数据检索",document.querySelector(".navContent").classList.remove("search"),document.querySelector(".navContent").classList.add("moved"),document.addEventListener("mouseup",u)}),window.addEventListener("keyup",e=>{"Escape"===e.key&&u()})});